plugins {
    id "com.android.library"
    id "kotlin-android"
    id "kotlin-kapt"
}

apply from: 'jacoco.gradle'

android {
    compileSdkVersion buildConfig.compileSdk
    buildToolsVersion buildConfig.buildTools

    defaultConfig {
        minSdkVersion buildConfig.minSdk
        targetSdkVersion buildConfig.targetSdk
        versionCode releaseConfig.versionCode
        versionName releaseConfig.version

        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"

        javaCompileOptions {
            annotationProcessorOptions {
                arguments = [
                        "room.incremental": "true",
                ]
            }
        }
    }

    buildTypes {
        debug {
            testCoverageEnabled true
            debuggable true
            minifyEnabled false
        }
        release {
            debuggable false
            minifyEnabled true
            proguardFiles getDefaultProguardFile("proguard-android.txt"), "proguard-rules.txt"
        }
    }

    resourcePrefix 'sentinel_'

    lintOptions {
        disable 'InvalidFragmentVersionForActivityResult', 'VectorPath'
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
    kotlinOptions {
        jvmTarget = JavaVersion.VERSION_1_8.toString()
        freeCompilerArgs += [
                '-Xopt-in=kotlin.ExperimentalStdlibApi',
                '-Xopt-in=org.koin.core.component.KoinApiExtension',
                '-Xexplicit-api=strict'
        ]
        useIR = true
    }
    testOptions {
        animationsDisabled = true
    }

    sourceSets.each {
        it.java.srcDirs += "src/$it.name/kotlin"
    }

    buildFeatures {
        viewBinding = true
    }
}

dependencies {
    implementation packages.kotlin.core
    implementation packages.kotlinx.coroutines
    implementation packages.androidx.core
    implementation packages.androidx.activity
    implementation packages.androidx.fragment
    implementation packages.androidx.lifecycle.livedata
    implementation packages.androidx.lifecycle.process
    implementation packages.androidx.preference
    implementation packages.androidx.startup
    implementation packages.androidx.room.runtime
    implementation packages.androidx.room.ktx
    kapt packages.androidx.room.compiler
    implementation packages.google.design
    implementation packages.koin.android
    implementation packages.koin.scope
    implementation packages.koin.viewmodel
    implementation packages.timber.core

    androidTestImplementation "junit:junit:4.13.2"
    androidTestImplementation 'androidx.arch.core:core-testing:2.1.0'
    androidTestImplementation 'androidx.test:core-ktx:1.3.0'
    androidTestImplementation 'androidx.test:rules:1.3.0'
    androidTestImplementation 'androidx.test:runner:1.3.0'
    androidTestImplementation 'androidx.test.ext:junit:1.1.2'
    androidTestImplementation "androidx.security:security-crypto:1.1.0-alpha03"
    androidTestImplementation "org.robolectric:shadowapi:4.3.1"
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.3.0'
    androidTestImplementation 'androidx.test.espresso:espresso-intents:3.3.0'
    androidTestImplementation "androidx.room:room-testing:2.2.6"
    androidTestImplementation 'androidx.fragment:fragment-ktx:1.3.1'
    androidTestImplementation 'androidx.fragment:fragment-testing:1.3.1'

    testImplementation "junit:junit:4.13.2"
    testImplementation 'androidx.test.ext:junit:1.1.2'
}

apply from: "publish.gradle"

project.gradle.taskGraph.whenReady {
    connectedDebugAndroidTest {
        ignoreFailures = true
    }
}