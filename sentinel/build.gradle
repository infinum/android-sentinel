apply plugin: 'com.android.library'
apply plugin: 'kotlin-android'
apply plugin: 'kotlin-kapt'
apply from: 'jacoco.gradle'

android {
    compileSdkVersion buildConfig.compileSdk
    buildToolsVersion buildConfig.buildTools

    defaultConfig {
        minSdkVersion buildConfig.minSdk
        targetSdkVersion buildConfig.targetSdk
        versionCode sentinel.versionCode
        versionName sentinel.version

        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"

        consumerProguardFiles 'consumer-rules.pro'

        javaCompileOptions {
            annotationProcessorOptions {
                arguments = [
                        "room.incremental": "true",
                ]
            }
        }
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
        debug {
            testCoverageEnabled true
        }
    }

    resourcePrefix 'sentinel_'

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
    kotlinOptions {
        jvmTarget = JavaVersion.VERSION_1_8.toString()
        freeCompilerArgs += [
                '-Xopt-in=org.koin.core.component.KoinApiExtension',
                '-Xexplicit-api=strict'
        ]
    }
    testOptions {
        animationsDisabled = true
    }

    sourceSets.each {
        it.java.srcDirs += "src/$it.name/kotlin"
    }

    buildFeatures {
        viewBinding = true
    }
}

dependencies {
    implementation packages.kotlin.core
    implementation packages.kotlinx.coroutines
    implementation packages.androidx.core
    implementation packages.androidx.fragment
    implementation packages.androidx.lifecycle.livedata
    implementation packages.androidx.lifecycle.process
    implementation packages.androidx.preference
    implementation packages.androidx.startup
    implementation packages.androidx.room.runtime
    implementation packages.androidx.room.ktx
    kapt packages.androidx.room.compiler
    implementation packages.google.design
    implementation packages.koin.android
    implementation packages.koin.scope
    implementation packages.koin.viewmodel
    implementation packages.timber.core

    androidTestImplementation "junit:junit:4.13"
    androidTestImplementation 'androidx.arch.core:core-testing:2.1.0'
    androidTestImplementation 'androidx.test:core-ktx:1.2.0'
    androidTestImplementation 'androidx.test:rules:1.2.0'
    androidTestImplementation 'androidx.test:runner:1.2.0'
    androidTestImplementation 'androidx.test.ext:junit:1.1.1'
    androidTestImplementation "androidx.security:security-crypto:1.1.0-alpha02"
    androidTestImplementation "org.robolectric:shadowapi:4.3.1"
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.2.0'
    androidTestImplementation 'androidx.test.espresso:espresso-intents:3.2.0'
    androidTestImplementation "androidx.room:room-testing:2.2.5"
    androidTestImplementation 'androidx.fragment:fragment:1.2.5'
    androidTestImplementation 'androidx.fragment:fragment-testing:1.2.5'

    testImplementation "junit:junit:4.13"
    testImplementation 'androidx.test.ext:junit:1.1.1'
}

apply from: "bintray.gradle"

project.gradle.taskGraph.whenReady {
    connectedDebugAndroidTest {
        ignoreFailures = true
    }
}